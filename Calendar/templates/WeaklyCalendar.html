{% load staticfiles %}

<!DOCTYPE <!DOCTYPE html>
<html>
    <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="{% static "css/bootstrap.min.css" %}">

<!-- Optional theme -->
<link rel="stylesheet" href="{% static "css/bootstrap-theme.min.css" %}">

<!-- Latest compiled and minified JavaScript -->
<script src="{% static "js/jquery.min.js" %}"></script>
<script src="{% static "js/moment.min.js" %}"></script>
<script src="{% static "js/bootstrap.min.js" %}"></script>

<link rel="stylesheet" href="{% static "css/bootstrap-datetimepicker.min.css" %}">

<script src="{% static "js/bootstrap-datetimepicker.min.js" %}"></script>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Calendar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="{% static "css/main.css" %}" />
</head>
<body>
<div class="row">
    <div class="row" align="center">
        <div class="col-md-12">
            <strong>{{year}}</strong>
        </div>
    </div>
    {% load filters %}
    <div class="table-responsive" align="center">
        <div class="col-md-12">
            <table id="calendar" class="table">
                <tr>
                    <th></th>
                    {% for day in week %}
                    <th>{{day}}</th>
                    {% endfor %}
                </tr>
                {% for i in range24 %}
                <tr> 
                    <th>{{i}}:00</th>
                    {% for j in range7 %}
                        {# id is time-day for example 8-17 it means 17th day of month and time is 8 #}
                        <td id={{i}}-{{week|lookup:j|slice:"0:2"}}></td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="etkinlik" class="modal fade" role="dialog">
    <div class="modal-dialog">
    
        <!-- Modal content-->
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Etkinlik</h4>
        </div>
        <div class="modal-body">
            <form>
            <div class="row">      
                    <div class="col-md-6">
                        <label for="title">Başlık</label>
            </div> 
            <div class="form-group col-md-6">
                <input type="text" class="form-control" id="title" placeholder="Başlık Giriniz">
            </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="datepicker">Tarih</label>
                </div>
                <div class="input-group date col-md-6" id="datepicker">
                <input type="text" class="form-control" id="date" placeholder="Tarih">
                <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
                </div>
            </div>
            <div class="row">      
                <div class="col-md-6">
                    <label for="timepicker-start">Başlangıç Saati</label>
                </div>        
                <div class="input-group date col-md-6" id="timepicker-start">
                    <input type='text' id="start_time" class="form-control" placeholder="Başlangıç Saati" />
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-time"></span>
                    </span>
                </div>   
            </div>
            <div class="row">      
                    <div class="col-md-6">
                        <label for="timepicker-end">Bitiş Saati</label>
                    </div> 
            <div class="input-group date col-md-6" id="timepicker-end">
                <input type='text' id="finish_time" class="form-control" placeholder="Bitiş Saati" />
                <span class="input-group-addon">
                    <span class="glyphicon glyphicon-time"></span>
                </span>
            </div> 
            </div>  
            <div class="row">      
                    <div class="col-md-6">
                        <label for="repeat_fre">Tekrar Sıklığı</label>
                    </div> 
            <div class="form-group col-md-6">
                <select class="form-control" id="repeat_fre">
                    <option value="1">Gün</option>
                    <option value="2">Hafta</option>
                    <option value="3">Ay</option>
                    <option value="4">Yıl</option>
                </select>
            </div>
            </div>
            <div class="row">      
                    <div class="col-md-6">
                        <label for="repeat_time">Tekrar Sayısı</label>
                    </div> 
            <div class="form-group col-md-6">
                <input type="number" min=1 max=20 class="form-control" id="repeat_time" placeholder="1">
            </div>  
            </div>
            <div class="row">      
                    <div class="col-md-6">
                        <label for="location">Konum</label>
                    </div> 
            <div class="form-group col-md-6">
                <input type="text" class="form-control" id="location" placeholder="Konum">
            </div>   
            </div>
            <div class="row">      
                    <div class="col-md-6">
                        <label for="color">Renk</label>
                    </div> 
            <div class="form-group col-md-6">
                <input type="text" class="form-control" id="color" placeholder="Renk">
            </div>                        
            </div>
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="private">
                <label class="form-check-label" for="ozel<">Özel Mi?</label>
            </div>
            <div class="form-group">
                <label for="comment">Açıklama</label>
                <textarea class="form-control" id="comment" rows="2"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Onayla</button>
            </form>
        </div>
        <div class="modal-footer">
            <button id="delete_button" name="" type="button" class="btn btn-danger" data-dismiss="modal">Sil</button>
        </div>
        </div>
    </div>
</div>
</body>

<script type="text/javascript">
    String.prototype.format = function() {
        var str = this;
        for (var i = 0; i < arguments.length; i++) {       
          var reg = new RegExp("\\{" + i + "\\}", "gm");             
          str = str.replace(reg, arguments[i]);
        }
        return str;
      };

    data = {{ activities | safe }};
    for(i=0;i<data.length;i++){
        for(j=parseInt(data[i].start_time);j<=parseInt(data[i].finish_time);j++){
            var str = "<a id={0} class={1}>{2}</a>".format(data[i].id, data[i].id, data[i].title)
            $("#"+j+"-"+data[i].date).append(str);
        };
    };

    $("a").click(function () {
        $.ajax({
            url: "/calendar/get/" + this.id,
            type: 'get',
            success: function (data) {
                $("#delete_button").attr("name", data.id);
                Object.keys(data).forEach(function(key) {
                    if(key=='private'){
                        $("#{0}".format(key)).prop("checked", data[key]);
                    }
                    $("#{0}".format(key)).val(data[key]);
                });
            },
        });
    });

    $("#delete_button").click(function () {
        $.ajax({
            url: "/calendar/delete/" + this.name,
            type: 'get',
            item: this.name,
            success: function (data) {
                $(".{0}".format(this.item)).remove();
                console.log("#{0}".format(this.item));
            },
        });
    });
</script>
<script src="{% static "js/main.js" %}"></script>

</html>